"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[366],{4354(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1-ros-fundamentals/rclpy-basics","title":"rclpy Basics","description":"rclpy is the Python client library for ROS 2. It provides the standard interface for Python programs to interact with ROS 2, allowing you to create nodes, publish and subscribe to topics, provide and use services, and more.","source":"@site/docs/module-1-ros-fundamentals/rclpy-basics.md","sourceDirName":"module-1-ros-fundamentals","slug":"/module-1-ros-fundamentals/rclpy-basics","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-ros-fundamentals/rclpy-basics","draft":false,"unlisted":false,"editUrl":"https://github.com/your-organization/physical-ai-humanoid-robotics-book/edit/main/book/docs/module-1-ros-fundamentals/rclpy-basics.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Nodes, Topics, and Services","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-ros-fundamentals/nodes-topics-services"},"next":{"title":"URDF for Humanoids","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-ros-fundamentals/urdf-for-humanoids"}}');var r=s(4848),l=s(8453);const o={sidebar_position:3},t="rclpy Basics",a={},c=[{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Core Components",id:"core-components",level:2},{value:"Node",id:"node",level:3},{value:"Creating Publishers",id:"creating-publishers",level:3},{value:"Creating Subscribers",id:"creating-subscribers",level:3},{value:"Creating Services",id:"creating-services",level:3},{value:"Creating Clients",id:"creating-clients",level:3},{value:"Working with Parameters",id:"working-with-parameters",level:2},{value:"Timers",id:"timers",level:2},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:2},{value:"Lifecycle Nodes",id:"lifecycle-nodes",level:2},{value:"Error Handling and Best Practices",id:"error-handling-and-best-practices",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"rclpy-basics",children:"rclpy Basics"})}),"\n",(0,r.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2. It provides the standard interface for Python programs to interact with ROS 2, allowing you to create nodes, publish and subscribe to topics, provide and use services, and more."}),"\n",(0,r.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,r.jsx)(n.p,{children:"rclpy is built on top of the ROS 2 client library (rcl) and provides a Pythonic interface to ROS 2 functionality. It handles the underlying complexities of ROS 2 communication, allowing you to focus on implementing your robot's behavior."}),"\n",(0,r.jsx)(n.h2,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsx)(n.h3,{id:"node",children:"Node"}),"\n",(0,r.jsx)(n.p,{children:"The Node is the fundamental building block in ROS 2. All communication in ROS 2 happens through nodes."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyNode(Node):\n    def __init__(self):\n        super().__init__('my_node_name')\n        # Node initialization code goes here\n\ndef main(args=None):\n    rclpy.init(args=args)  # Initialize ROS 2 communications\n    node = MyNode()        # Create node\n    rclpy.spin(node)       # Keep node running until shutdown\n    node.destroy_node()    # Clean up resources\n    rclpy.shutdown()       # Shutdown ROS 2 communications\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-publishers",children:"Creating Publishers"}),"\n",(0,r.jsx)(n.p,{children:"A publisher allows a node to send messages to a topic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from std_msgs.msg import String\n\nclass PublisherNode(Node):\n    def __init__(self):\n        super().__init__('publisher_node')\n        self.publisher = self.create_publisher(String, 'topic_name', 10)\n        # 10 is the queue size (how many messages to buffer if subscriber is slow)\n\n    def publish_message(self, message):\n        msg = String()\n        msg.data = message\n        self.publisher.publish(msg)\n        self.get_logger().info(f'Published: {message}')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-subscribers",children:"Creating Subscribers"}),"\n",(0,r.jsx)(n.p,{children:"A subscriber allows a node to receive messages from a topic:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from std_msgs.msg import String\n\nclass SubscriberNode(Node):\n    def __init__(self):\n        super().__init__('subscriber_node')\n        self.subscription = self.create_subscription(\n            String,\n            'topic_name',\n            self.listener_callback,\n            10)  # Queue size\n        self.subscription  # Prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: {msg.data}')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-services",children:"Creating Services"}),"\n",(0,r.jsx)(n.p,{children:"Services allow for request-response communication:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\n\nclass ServiceNode(Node):\n    def __init__(self):\n        super().__init__('service_node')\n        self.srv = self.create_service(\n            AddTwoInts, \n            'add_two_ints', \n            self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning {response.sum}')\n        return response\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-clients",children:"Creating Clients"}),"\n",(0,r.jsx)(n.p,{children:"Clients call services:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\n\nclass ClientNode(Node):\n    def __init__(self):\n        super().__init__('client_node')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        \n        # Wait for service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        \n        self.send_request(2, 3)  # Example request\n\n    def send_request(self, a, b):\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n        self.future = self.cli.call_async(request)\n        self.future.add_done_callback(self.service_response_callback)\n\n    def service_response_callback(self, future):\n        response = future.result()\n        self.get_logger().info(f'Result: {response.sum}')\n"})}),"\n",(0,r.jsx)(n.h2,{id:"working-with-parameters",children:"Working with Parameters"}),"\n",(0,r.jsx)(n.p,{children:"Nodes can have configurable parameters:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n        \n        # Declare parameters with default values\n        self.declare_parameter('param_name', 'default_value')\n        self.declare_parameter('threshold', 0.5)\n        \n        # Get parameter value\n        param_value = self.get_parameter('param_name').get_parameter_value().string_value\n        threshold = self.get_parameter('threshold').get_parameter_value().double_value\n        \n        self.get_logger().info(f'Parameter value: {param_value}, Threshold: {threshold}')\n"})}),"\n",(0,r.jsx)(n.h2,{id:"timers",children:"Timers"}),"\n",(0,r.jsx)(n.p,{children:"Timers allow you to execute code at regular intervals:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class TimerNode(Node):\n    def __init__(self):\n        super().__init__('timer_node')\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        self.get_logger().info(f'Timer callback {self.i}')\n        self.i += 1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,r.jsx)(n.p,{children:"QoS settings allow you to specify the delivery guarantees for your messages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\n\n# Create a QoS profile with specific settings\nqos_profile = QoSProfile(\n    depth=10,\n    reliability=ReliabilityPolicy.RELIABLE,  # or BEST_EFFORT\n    durability=DurabilityPolicy.VOLATILE    # or TRANSIENT_LOCAL\n)\n\npublisher = self.create_publisher(String, 'topic_name', qos_profile)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"lifecycle-nodes",children:"Lifecycle Nodes"}),"\n",(0,r.jsx)(n.p,{children:"For more complex systems, you might want to use lifecycle nodes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from rclpy.lifecycle import LifecycleNode, LifecycleState\nfrom rclpy.lifecycle import TransitionCallbackReturn\n\nclass LifecycleExampleNode(LifecycleNode):\n    def __init__(self):\n        super().__init__('lifecycle_example_node')\n        \n    def on_configure(self, state):\n        self.get_logger().info(f'Configuring from state: {state}')\n        return TransitionCallbackReturn.SUCCESS\n        \n    def on_activate(self, state):\n        self.get_logger().info(f'Activating from state: {state}')\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,r.jsx)(n.h2,{id:"error-handling-and-best-practices",children:"Error Handling and Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Always handle exceptions"})," when calling services or processing messages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use appropriate QoS settings"})," for your use case"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Initialize and shutdown properly"})," to prevent resource leaks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use logging"})," to track node behavior"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Follow naming conventions"})," for consistency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep nodes focused"})," on a single responsibility"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"rclpy provides a powerful and flexible interface to ROS 2 functionality, enabling you to build sophisticated robotic applications in Python."})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);